================================================================
    H∆Ø·ªöNG D·∫™N CH·∫†Y H·ªÜ TH·ªêNG PH√ÅT HI·ªÜN BU·ªíN NG·ª¶ TR√äN PI 4
================================================================

üì¶ PROJECT C√ì G√å?
================================================================

Files ch√≠nh:
  ‚úÖ main.py                - Code ch√≠nh (200 d√≤ng)
  ‚úÖ best.pt                - Model YOLO ƒë√£ train
  ‚úÖ requirements_minimal.txt - Th∆∞ vi·ªán c·∫ßn c√†i
  ‚úÖ README.md              - T√†i li·ªáu chi ti·∫øt
  ‚úÖ HUONG_DAN.txt          - File n√†y

Ch·ª©c nƒÉng:
  - Ph√°t hi·ªán 5 h√†nh vi: awake, drowsy, texting, talking, turning
  - C·∫£nh b√°o b·∫±ng c√≤i GPIO khi ph√°t hi·ªán nguy hi·ªÉm
  - Kh√¥ng c·∫ßn internet (100% offline)

Hi·ªáu nƒÉng Pi 4:
  FPS:      8-12 fps
  RAM:      300MB
  CPU:      65-80%
  Nhi·ªát ƒë·ªô: 56-60¬∞C

================================================================
    B∆Ø·ªöC 1: CHU·∫®N B·ªä PH·∫¶N C·ª®NG
================================================================

C·∫ßn c√≥:
  ‚ñ° Raspberry Pi 4 (2GB/4GB/8GB)
  ‚ñ° Camera USB ho·∫∑c Pi Camera
  ‚ñ° Buzzer 5V (~10k VNƒê)
  ‚ñ° ƒêi·ªán tr·ªü 220Œ©
  ‚ñ° 2 d√¢y n·ªëi
  ‚ñ° SD Card 16GB+ (ƒë√£ c√†i Raspberry Pi OS)

K·∫øt n·ªëi Buzzer:
  
  Pi GPIO17 (Pin 11) ‚îÄ‚îÄ[220Œ©]‚îÄ‚îÄ‚ñ∫ Buzzer (+)
  Pi GND (Pin 6) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Buzzer (-)

S∆° ƒë·ªì Pin:
  
    3.3V [ 1] [ 2] 5V
   GPIO2 [ 3] [ 4] 5V
   GPIO3 [ 5] [ 6] GND ‚óÑ‚îÄ‚îÄ‚îÄ GND cho Buzzer
   GPIO4 [ 7] [ 8] GPIO14
     GND [ 9] [10] GPIO15
   GPIO17[11] [12] GPIO18 ‚óÑ‚îÄ GPIO17 cho Buzzer
   GPIO27[13] [14] GND
     ...

================================================================
    B∆Ø·ªöC 2: C√ÄI ƒê·∫∂T H·ªÜ TH·ªêNG (1 L·∫¶N DUY NH·∫§T)
================================================================

1. Update h·ªá th·ªëng (3-5 ph√∫t):
   
   sudo apt update && sudo apt upgrade -y

2. C√†i th∆∞ vi·ªán c∆° b·∫£n (2 ph√∫t):
   
   sudo apt install python3-opencv python3-rpi.gpio -y

3. C√†i PyTorch + YOLO (10-15 ph√∫t - QUAN TR·ªåNG!):
   
   pip3 install ultralytics torch torchvision

4. Ki·ªÉm tra c√†i ƒë·∫∑t:
   
   python3 -c "import cv2, RPi.GPIO, ultralytics; print('OK')"
   
   Ph·∫£i th·∫•y: OK

================================================================
    B∆Ø·ªöC 3: COPY CODE V√ÄO PI
================================================================

C√°ch 1: USB/SD Card
   
   cp -r /media/usb/project ~/project
   cd ~/project

C√°ch 2: SCP t·ª´ PC
   
   scp -r project/ pi@192.168.x.x:~/project

C√°ch 3: Git
   
   git clone https://github.com/your-repo/project.git
   cd project

Ki·ªÉm tra files:
   
   ls -la
   
   Ph·∫£i c√≥: main.py, best.pt

================================================================
    B∆Ø·ªöC 4: TEST CAMERA
================================================================

USB Camera:
   
   ls -l /dev/video*
   
   Ph·∫£i th·∫•y: /dev/video0

Pi Camera:
   
   sudo raspi-config
   # Ch·ªçn: Interface Options ‚Üí Camera ‚Üí Enable ‚Üí Reboot

Test camera ho·∫°t ƒë·ªông:
   
   python3 -c "import cv2; cap=cv2.VideoCapture(0); print('OK' if cap.isOpened() else 'FAIL')"

================================================================
    B∆Ø·ªöC 5: TEST BUZZER
================================================================

T·∫°o file test:
   
   cat > test_buzzer.py << 'EOF'
   import RPi.GPIO as GPIO
   import time
   
   GPIO.setmode(GPIO.BCM)
   GPIO.setup(17, GPIO.OUT)
   
   print("Testing buzzer...")
   for i in range(3):
       print(f"Beep {i+1}")
       GPIO.output(17, GPIO.HIGH)
       time.sleep(0.5)
       GPIO.output(17, GPIO.LOW)
       time.sleep(0.5)
   
   GPIO.cleanup()
   print("Test completed!")
   EOF

Ch·∫°y test:
   
   sudo python3 test_buzzer.py

K·∫øt qu·∫£:
   ‚úÖ C√≤i k√™u 3 ti·∫øng ‚Üí OK, sang b∆∞·ªõc ti·∫øp
   ‚ùå Kh√¥ng k√™u ‚Üí Ki·ªÉm tra l·∫°i k·∫øt n·ªëi d√¢y

================================================================
    B∆Ø·ªöC 6: CH·∫†Y CH∆Ø∆†NG TR√åNH
================================================================

Ch·∫°y th√¥ng th∆∞·ªùng:
   
   cd ~/project
   sudo python3 main.py

Ch·∫°y background:
   
   nohup sudo python3 main.py > output.log 2>&1 &

Xem log (n·∫øu ch·∫°y background):
   
   tail -f output.log

D·ª´ng ch∆∞∆°ng tr√¨nh:
   - Nh·∫•n 'q' trong c·ª≠a s·ªï OpenCV
   - Ho·∫∑c Ctrl+C trong terminal

Kill process (n·∫øu treo):
   
   pkill -f main.py

================================================================
    OUTPUT KHI CH·∫†Y
================================================================

Khi kh·ªüi ƒë·ªông:
   ‚úÖ GPIO initialized - Buzzer on GPIO17
   ‚úÖ Model loaded: runs/detect/train24/weights/best.pt
   üì∑ Camera ready
   üöÄ B·∫Øt ƒë·∫ßu gi√°m s√°t...

Khi ph√°t hi·ªán nguy hi·ªÉm:
   üö® ALERT: Ph√°t hi·ªán drowsy!
   üîä C√≤i ON - GPIO17
   üîá C√≤i OFF
   
   üö® ALERT: Ph√°t hi·ªán texting_phone!
   üîä C√≤i ON - GPIO17
   üîá C√≤i OFF

================================================================
    C·∫§U H√åNH (T√ôY CH·ªåN)
================================================================

Ch·ªânh file main.py:
   
   nano main.py

Thay ƒë·ªïi GPIO pin (d√≤ng 20):
   BUZZER_PIN = 17  # ƒê·ªïi th√†nh 18, 22, 23, 24, 25...

Thay ƒë·ªïi th·ªùi gian c√≤i (d√≤ng 21):
   BUZZER_DURATION = 2  # ƒê·ªïi th√†nh 1, 3, 4, 5 gi√¢y

Thay ƒë·ªïi cooldown (d√≤ng 42-47):
   alert_cooldowns = {
       'drowsy': 15,         # 15 gi√¢y
       'texting_phone': 10,  # 10 gi√¢y
       'talking_phone': 8,   # 8 gi√¢y
       'turning': 5          # 5 gi√¢y
   }

Thay ƒë·ªïi ƒë·ªô nh·∫°y (d√≤ng 50):
   DETECTION_DURATION_THRESHOLD = 3  # H√†nh vi k√©o d√†i 3s m·ªõi b√°o

Gi·∫£m image size n·∫øu lag (d√≤ng 133):
   results = model(frame, conf=0.65, verbose=False, imgsz=320)
   # ƒê·ªïi t·ª´ 640 ‚Üí 320

================================================================
    T·ª∞ ƒê·ªòNG CH·∫†Y KHI KH·ªûI ƒê·ªòNG
================================================================

1. Ch·ªânh rc.local:
   
   sudo nano /etc/rc.local

2. Th√™m d√≤ng n√†y TR∆Ø·ªöC "exit 0":
   
   cd /home/pi/project && sudo python3 main.py &

3. L∆∞u: Ctrl+X ‚Üí Y ‚Üí Enter

4. Reboot ƒë·ªÉ test:
   
   sudo reboot

Sau reboot, ch∆∞∆°ng tr√¨nh t·ª± ƒë·ªông ch·∫°y!

================================================================
    X·ª¨ L√ù L·ªñI TH∆Ø·ªúNG G·∫∂P
================================================================

1. L·ªñI GPIO PERMISSION
   RuntimeError: No access to /dev/mem
   
   Gi·∫£i ph√°p:
   ‚Üí Lu√¥n ch·∫°y v·ªõi sudo
   sudo python3 main.py

2. CAMERA KH√îNG HO·∫†T ƒê·ªòNG
   Kh√¥ng th·ªÉ l·∫•y d·ªØ li·ªáu t·ª´ webcam!
   
   Gi·∫£i ph√°p:
   ‚Üí Ki·ªÉm tra camera c√≥ s·∫µn:
   ls -l /dev/video*
   
   ‚Üí Th·ª≠ index kh√°c (s·ª≠a main.py d√≤ng 118):
   cap = cv2.VideoCapture(0)  # Th·ª≠ 0, 1, 2

3. MODEL KH√îNG T√åM TH·∫§Y
   FileNotFoundError: best.pt
   
   Gi·∫£i ph√°p:
   ‚Üí Ki·ªÉm tra file:
   ls -la best.pt
   
   ‚Üí S·ª≠a ƒë∆∞·ªùng d·∫´n (main.py d√≤ng 30):
   model = YOLO("best.pt")
   # Ho·∫∑c ƒë∆∞·ªùng d·∫´n ƒë·∫ßy ƒë·ªß

4. BUZZER KH√îNG K√äU
   
   Checklist:
   ‚ñ° ƒê√£ k·∫øt n·ªëi ƒë√∫ng GPIO17 v√† GND?
   ‚ñ° ƒêi·ªán tr·ªü ƒë√∫ng 220Œ©?
   ‚ñ° Buzzer c√≥ h·ªèng kh√¥ng? (test b·∫±ng pin 3V)
   ‚ñ° C√≥ ch·∫°y v·ªõi sudo?
   ‚ñ° Ch·∫°y test_buzzer.py c√≥ k√™u kh√¥ng?

5. FPS QU√Å TH·∫§P (<5 fps)
   
   Gi·∫£i ph√°p:
   ‚Üí Gi·∫£m image size (main.py d√≤ng 133):
   results = model(frame, conf=0.65, verbose=False, imgsz=320)
   
   ‚Üí Ho·∫∑c skip frames:
   frame_count = 0
   if frame_count % 2 == 0:  # X·ª≠ l√Ω 1, b·ªè 1
       results = model(frame, ...)
   frame_count += 1

6. NHI·ªÜT ƒê·ªò CAO (>70¬∞C)
   
   Gi·∫£i ph√°p:
   ‚Üí Ki·ªÉm tra nhi·ªát ƒë·ªô:
   vcgencmd measure_temp
   
   ‚Üí G·∫Øn heatsink + fan
   ‚Üí Gi·∫£m image size xu·ªëng 320
   ‚Üí ƒê·∫∑t Pi ·ªü ch·ªó tho√°ng

================================================================
    MONITOR H·ªÜ TH·ªêNG
================================================================

CPU + RAM:
   htop

Nhi·ªát ƒë·ªô realtime:
   watch -n 1 vcgencmd measure_temp

RAM available:
   free -h

Xem log:
   tail -f output.log

Kill process:
   pkill -f main.py

Backup project:
   tar -czf backup_$(date +%Y%m%d).tar.gz ~/project/

================================================================
    CHECKLIST TR∆Ø·ªöC KHI CH·∫†Y
================================================================

Chu·∫©n b·ªã:
  ‚ñ° Pi 4 ƒë√£ c√†i Raspberry Pi OS
  ‚ñ° ƒê√£ ch·∫°y: sudo apt update && sudo apt upgrade
  ‚ñ° ƒê√£ c√†i: python3-opencv, python3-rpi.gpio
  ‚ñ° ƒê√£ c√†i: ultralytics, torch, torchvision
  
Files:
  ‚ñ° main.py c√≥ trong th∆∞ m·ª•c
  ‚ñ° best.pt c√≥ trong th∆∞ m·ª•c
  
Ph·∫ßn c·ª©ng:
  ‚ñ° Camera ƒë√£ k·∫øt n·ªëi
  ‚ñ° Test camera OK (ls -l /dev/video*)
  ‚ñ° Buzzer ƒë√£ k·∫øt n·ªëi GPIO17 v√† GND
  ‚ñ° Test buzzer OK (test_buzzer.py k√™u 3 ti·∫øng)
  
Ch·∫°y:
  ‚ñ° ƒê√£ cd v√†o th∆∞ m·ª•c project
  ‚ñ° Ch·∫°y v·ªõi sudo: sudo python3 main.py

================================================================
    COMMANDS NHANH
================================================================

Setup (1 l·∫ßn):
   sudo apt update && sudo apt upgrade -y
   sudo apt install python3-opencv python3-rpi.gpio -y
   pip3 install ultralytics torch torchvision

Test camera:
   ls -l /dev/video*

Test buzzer:
   sudo python3 test_buzzer.py

Ch·∫°y:
   cd ~/project
   sudo python3 main.py

D·ª´ng:
   Ctrl+C

Kill:
   pkill -f main.py

Monitor:
   htop
   vcgencmd measure_temp

================================================================
    TH√îNG S·ªê K·ª∏ THU·∫¨T
================================================================

Raspberry Pi 4:
  Model:        Pi 4 Model B
  RAM:          2GB/4GB/8GB (khuy·∫øn ngh·ªã 4GB)
  OS:           Raspberry Pi OS (64-bit)
  Python:       3.11+

GPIO:
  Pin:          GPIO17 (Physical Pin 11)
  Mode:         BCM numbering
  Voltage:      3.3V output
  Max current:  16mA

Buzzer:
  Type:         Active ho·∫∑c Passive
  Voltage:      5V
  Current:      ~30mA
  Resistor:     220Œ© ho·∫∑c 330Œ©

Camera:
  Type:         USB Camera ho·∫∑c Pi Camera Module
  Resolution:   640x480 (c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh)
  FPS:          30 fps input ‚Üí 8-12 fps processing

Model:
  Framework:    YOLOv8
  Size:         ~6MB
  Classes:      5 (awake, drowsy, texting, talking, turning)
  Image size:   640x640 (c√≥ th·ªÉ gi·∫£m xu·ªëng 320)

Performance:
  FPS:          8-12 fps (Pi 4)
  RAM:          300MB
  CPU:          65-80%
  Temp:         56-60¬∞C
  Alert time:   <0.2s

================================================================
    LI√äN H·ªÜ & H·ªñ TR·ª¢
================================================================

D·ª± √°n:
  T√™n:    H·ªá Th·ªëng Ph√°t Hi·ªán Bu·ªìn Ng·ªß Khi L√°i Xe
  Version: v2.0 (GPIO Buzzer)
  ƒê∆°n v·ªã: AIoTLab - ƒê·∫°i H·ªçc ƒê·∫°i Nam

T√†i li·ªáu:
  README.md           - T√†i li·ªáu chi ti·∫øt
  HUONG_DAN.txt       - File n√†y
  HARDWARE_DIAGRAM.txt - S∆° ƒë·ªì ph·∫ßn c·ª©ng

================================================================

                    üéâ CH√öC B·∫†N TH√ÄNH C√îNG! üéâ

        N·∫øu c√≥ v·∫•n ƒë·ªÅ, ƒë·ªçc l·∫°i ph·∫ßn "X·ª¨ L√ù L·ªñI TH∆Ø·ªúNG G·∫∂P"
                ho·∫∑c xem README.md ƒë·ªÉ bi·∫øt chi ti·∫øt

================================================================

